<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {%- seo -%}
  <link rel="stylesheet" href="{{ "/assets/css/style.css" | relative_url }}">
  {%- feed_meta -%}
  {%- if jekyll.environment == 'production' and site.google_analytics -%}
    {%- include google-analytics.html -%}
  {%- endif -%}

  <script>
    // Theme persistence and management
    function initializeTheme() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme === 'dark' || (savedTheme === null && prefersDark)) {
        document.body.classList.add('dark-mode');
        applyDarkModeStyles();
      } else {
        document.body.classList.remove('dark-mode');
        applyLightModeStyles();
      }
    }

    function toggleTheme() {
      console.log("Theme toggle clicked!");
      const body = document.body;
      const isDark = body.classList.contains('dark-mode');
      
      if (isDark) {
        body.classList.remove('dark-mode');
        localStorage.setItem('theme', 'light');
        applyLightModeStyles();
        console.log("Switched to light mode");
      } else {
        body.classList.add('dark-mode');
        localStorage.setItem('theme', 'dark');
        applyDarkModeStyles();
        console.log("Switched to dark mode");
      }
    }

    function applyDarkModeStyles() {
      // Force dark mode styles with inline CSS as backup
      document.body.style.backgroundColor = '#1a1a1a';
      document.body.style.color = '#e0e0e0';
      
      // Apply to all elements
      const headers = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
      headers.forEach(h => h.style.color = '#e0e0e0');
      
      const paragraphs = document.querySelectorAll('p');
      paragraphs.forEach(p => p.style.color = '#e0e0e0');
      
      const links = document.querySelectorAll('a');
      links.forEach(link => link.style.color = '#4a9eff');
      
      // Header
      const header = document.querySelector('.site-header');
      if (header) {
        header.style.backgroundColor = '#2d2d2d';
        header.style.borderBottom = '1px solid #444';
      }
      
      // Footer
      const footer = document.querySelector('.site-footer');
      if (footer) {
        footer.style.backgroundColor = '#2d2d2d';
        footer.style.borderTop = '1px solid #444';
      }
      
      // Navigation links
      const navLinks = document.querySelectorAll('.page-link, .mobile-link');
      navLinks.forEach(link => link.style.color = '#e0e0e0');
      
      // Theme toggle buttons
      const toggleButtons = document.querySelectorAll('.theme-toggle');
      toggleButtons.forEach(btn => {
        btn.style.borderColor = '#e0e0e0';
        btn.style.color = '#e0e0e0';
      });
      
      // Hamburger lines
      const hamburgerLines = document.querySelectorAll('.hamburger-line');
      hamburgerLines.forEach(line => line.style.backgroundColor = '#e0e0e0');
    }

    function applyLightModeStyles() {
      // Force light mode styles with inline CSS as backup
      document.body.style.backgroundColor = '#ffffff';
      document.body.style.color = '#333333';
      
      // Apply to all elements
      const headers = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
      headers.forEach(h => h.style.color = '#333333');
      
      const paragraphs = document.querySelectorAll('p');
      paragraphs.forEach(p => p.style.color = '#333333');
      
      const links = document.querySelectorAll('a');
      links.forEach(link => link.style.color = '#2563eb');
      
      // Header
      const header = document.querySelector('.site-header');
      if (header) {
        header.style.backgroundColor = '#f8f9fa';
        header.style.borderBottom = '1px solid #e9ecef';
      }
      
      // Footer
      const footer = document.querySelector('.site-footer');
      if (footer) {
        footer.style.backgroundColor = '#f8f9fa';
        footer.style.borderTop = '1px solid #e9ecef';
      }
      
      // Navigation links
      const navLinks = document.querySelectorAll('.page-link, .mobile-link');
      navLinks.forEach(link => link.style.color = '#333333');
      
      // Theme toggle buttons
      const toggleButtons = document.querySelectorAll('.theme-toggle');
      toggleButtons.forEach(btn => {
        btn.style.borderColor = '#333333';
        btn.style.color = '#333333';
      });
      
      // Hamburger lines
      const hamburgerLines = document.querySelectorAll('.hamburger-line');
      hamburgerLines.forEach(line => line.style.backgroundColor = '#333333');
    }

    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      const hamburger = document.querySelector('.hamburger');
      
      if (menu && hamburger) {
        menu.classList.toggle('active');
        hamburger.classList.toggle('active');
      }
    }

    // Initialize theme when page loads
    document.addEventListener('DOMContentLoaded', function() {
      try {
        initializeTheme();
        
        // Re-apply styles after a short delay to ensure all elements are loaded
        setTimeout(() => {
          if (document.body && document.body.classList.contains('dark-mode')) {
            applyDarkModeStyles();
          } else {
            applyLightModeStyles();
          }
        }, 100);
      } catch (error) {
        console.log('Theme initialization error:', error);
      }
    });

    // Initialize theme immediately for faster loading
    try {
      initializeTheme();
    } catch (error) {
      console.log('Initial theme setup error:', error);
    }
  </script>
</head>
